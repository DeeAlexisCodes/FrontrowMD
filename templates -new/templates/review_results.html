<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review Results - FrontrowMD</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --background-color: #F8F9FA;
            --text-primary: #121212;
            --text-secondary: #555;
            --accent-primary: #FF6B00;
            --border-subtle: #E0E0E0;
            --card-bg: #FFFFFF;
            --code-bg: #2d333b;
            --code-text: #cdd9e5;
            --success-color: #10B981;
            --danger-color: #EF4444;

            --font-family-sans: 'Inter', sans-serif;
            --font-family-mono: 'Menlo', 'Consolas', monospace;
            --font-weight-regular: 400;
            --font-weight-medium: 500;
            --font-weight-bold: 700;

            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 32px;
            --spacing-xl: 48px;

            --border-radius-medium: 12px;
            --border-radius-large: 16px;
            --border-radius-full: 50%;
            
            --shadow-soft: 0px 4px 12px rgba(0, 0, 0, 0.05);
            --shadow-medium: 0px 8px 24px rgba(0, 0, 0, 0.1);
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        body {
            font-family: var(--font-family-sans);
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-lg);
        }

        /* Header & Footer */
        .header { padding: var(--spacing-md) 0; }
        .header__container { display: flex; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: var(--font-weight-bold); text-decoration: none; color: var(--text-primary); display: flex; align-items: center; gap: 8px; }
        .logo__icon { color: var(--accent-primary); }
        .footer { padding: var(--spacing-xl) 0; text-align: center; font-size: 0.9rem; color: #aaa; }

        /* Main Content */
        .main-content { padding: var(--spacing-xl) 0; }
        
        .page-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
            animation: fadeIn 0.5s ease-out;
        }

        .page-title { font-size: 2rem; font-weight: var(--font-weight-bold); }
        
        /* Carousel */
        .carousel-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-md);
            animation: fadeIn 0.5s ease-out 0.2s backwards;
        }

        .carousel-btn {
            background: var(--card-bg);
            border: 1px solid var(--border-subtle);
            border-radius: var(--border-radius-full);
            width: 44px;
            height: 44px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-soft);
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        .carousel-btn:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-medium);
        }
        .carousel-btn svg { width: 24px; height: 24px; color: var(--text-secondary); }

        .carousel-viewport {
            width: 100%;
            max-width: 800px;
            overflow: hidden;
        }

        .carousel-track {
            display: flex;
            align-items: center;
            transition: transform 0.4s ease-out;
        }

        .review-card {
            background: var(--card-bg);
            border-radius: var(--border-radius-large);
            box-shadow: var(--shadow-soft);
            padding: var(--spacing-lg);
            text-align: center;
            flex: 0 0 80%;
            margin: 0 10px; /* Provides spacing, controlled by JS */
            max-width: 400px;
            cursor: pointer;
            transition: transform 0.4s ease, opacity 0.4s ease;
            transform: scale(0.85);
            opacity: 0.6;
            position: relative;
        }

        @media (min-width: 768px) {
            .review-card {
                flex-basis: 60%;
            }
        }

        .review-card.is-active {
            transform: scale(1);
            opacity: 1;
        }

        /* Card Action Buttons */
        .card-actions {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            display: flex;
            gap: var(--spacing-sm);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .review-card.is-active:hover .card-actions {
            opacity: 1;
        }

        .action-btn {
            background: var(--card-bg);
            border: 1px solid var(--border-subtle);
            border-radius: var(--border-radius-medium);
            padding: var(--spacing-sm) var(--spacing-md);
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: var(--font-weight-medium);
            transition: all 0.2s ease;
            box-shadow: var(--shadow-soft);
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .action-btn.accept {
            background: var(--success-color);
            color: white;
            border-color: var(--success-color);
        }

        .action-btn.reject {
            background: var(--danger-color);
            color: white;
            border-color: var(--danger-color);
        }

        .edit-icon {
            background: var(--card-bg);
            border: 1px solid var(--border-subtle);
            border-radius: var(--border-radius-full);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-soft);
        }

        .edit-icon:hover {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .edit-icon svg {
            width: 16px;
            height: 16px;
        }

        .doctor-info { display: flex; flex-direction: column; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-md); }
        .doctor-info img { width: 80px; height: 80px; border-radius: var(--border-radius-full); object-fit: cover; box-shadow: var(--shadow-soft); }
        .doctor-info .name { font-weight: var(--font-weight-bold); }
        
        .review-card__title { font-size: 1.25rem; font-weight: var(--font-weight-bold); margin-bottom: var(--spacing-sm); }
        .review-card__text { color: var(--text-secondary); }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        .modal.is-visible { display: flex; }
        
        .modal-content {
            background: var(--background-color);
            border-radius: var(--border-radius-large);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        /* Small Modal for Accept/Reject */
        .modal-content.small {
            max-width: 500px;
            max-height: 400px;
        }
        
        .modal-body {
             padding: var(--spacing-xl);
        }

        .modal-close {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            background: var(--border-subtle);
            border: none;
            border-radius: var(--border-radius-full);
            width: 32px;
            height: 32px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        
        .modal-close:hover {
            background: var(--text-secondary);
            color: white;
        }

        .modal-section-title {
            font-size: 1.1rem;
            font-weight: var(--font-weight-bold);
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-sm);
            border-bottom: 1px solid var(--border-subtle);
        }
        
        #modal-review-text p { margin-bottom: 1em; }
        
        #modal-research-list {
            list-style: none;
            display: grid;
            gap: var(--spacing-md);
        }
        
        .modal-research-card {
            background: var(--card-bg);
            border: 1px solid var(--border-subtle);
            border-radius: var(--border-radius-medium);
            padding: var(--spacing-md);
        }
        
        .modal-research-card__title {
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--spacing-sm);
        }

        .modal-research-card__source {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-sm);
        }
        .modal-research-card__source a { color: var(--accent-primary); text-decoration: none; }
        .modal-research-card__source a:hover { text-decoration: underline; }
        
        .modal-research-card__excerpt {
            font-size: 0.95rem;
            padding-left: var(--spacing-md);
            border-left: 3px solid var(--accent-primary);
            color: var(--text-secondary);
        }

        .prompt-display {
            background: var(--code-bg);
            color: var(--code-text);
            padding: var(--spacing-md);
            border-radius: var(--border-radius-medium);
            font-family: var(--font-family-mono);
            font-size: 0.9rem;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* Success Modal Styles */
        .success-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 64px;
            height: 64px;
            background: var(--success-color);
            border-radius: var(--border-radius-full);
            margin: 0 auto var(--spacing-md);
        }

        .success-icon svg {
            width: 32px;
            height: 32px;
            color: white;
        }

        .success-title {
            font-size: 1.5rem;
            font-weight: var(--font-weight-bold);
            text-align: center;
            margin-bottom: var(--spacing-sm);
            color: var(--success-color);
        }

        .success-message {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-lg);
        }

        /* Reject Modal Styles */
        .reject-form {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .reject-title {
            font-size: 1.5rem;
            font-weight: var(--font-weight-bold);
            text-align: center;
            margin-bottom: var(--spacing-md);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .form-label {
            font-weight: var(--font-weight-medium);
            color: var(--text-primary);
        }

        .form-textarea {
            padding: var(--spacing-md);
            border: 1px solid var(--border-subtle);
            border-radius: var(--border-radius-medium);
            font-family: var(--font-family-sans);
            font-size: 1rem;
            resize: vertical;
            min-height: 120px;
        }

        .form-textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 0, 0.1);
        }

        .form-submit {
            background: var(--danger-color);
            color: white;
            border: none;
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--border-radius-medium);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .form-submit:hover {
            background: #DC2626;
            transform: translateY(-1px);
        }

        .form-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Edit Modal Styles */
        .edit-form {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .edit-title {
            font-size: 1.5rem;
            font-weight: var(--font-weight-bold);
            text-align: center;
            margin-bottom: var(--spacing-md);
        }

        .form-row {
            display: flex;
            gap: var(--spacing-md);
            align-items: flex-end;
        }

        .form-row .form-group {
            flex: 1;
        }

        .form-input {
            padding: var(--spacing-md);
            border: 1px solid var(--border-subtle);
            border-radius: var(--border-radius-medium);
            font-family: var(--font-family-sans);
            font-size: 1rem;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 0, 0.1);
        }

        .word-count-options {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }

        .word-count-btn {
            background: var(--card-bg);
            border: 1px solid var(--border-subtle);
            border-radius: var(--border-radius-medium);
            padding: var(--spacing-sm) var(--spacing-md);
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .word-count-btn:hover,
        .word-count-btn.active {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .current-review-preview {
            background: var(--card-bg);
            border: 1px solid var(--border-subtle);
            border-radius: var(--border-radius-medium);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            max-height: 200px;
            overflow-y: auto;
        }

        .preview-title {
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--spacing-sm);
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .form-submit.primary {
            background: var(--accent-primary);
            color: white;
        }

        .form-submit.primary:hover {
            background: #E55A00;
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: var(--spacing-sm);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .current-review-preview.editing {
            overflow: hidden;
        }

        .review-content {
            transition: opacity 0.3s ease;
        }

        .review-content.fade-out {
            opacity: 0.3;
        }

        .editing-animation {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--card-bg);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2;
        }

        .editing-animation.active {
            display: flex;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
            margin-bottom: var(--spacing-md);
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--accent-primary);
            border-radius: 50%;
            animation: typingPulse 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        .typing-dot:nth-child(3) { animation-delay: 0s; }

        @keyframes typingPulse {
            0%, 80%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .editing-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-align: center;
            font-weight: var(--font-weight-medium);
        }

        .progress-bar {
            width: 200px;
            height: 4px;
            background: var(--border-subtle);
            border-radius: 2px;
            margin-top: var(--spacing-md);
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent-primary);
            width: 0%;
            border-radius: 2px;
            transition: width 0.1s ease;
        }

    </style>
</head>
<body>

    <header class="header">
        <div class="container header__container">
            <a href="/" class="logo"><span class="logo__icon">+</span><span>FrontrowMD</span></a>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <header class="page-header">
                <h1 class="page-title">Generated Review Templates</h1>
            </header>

            <div class="carousel-container">
                <button id="prev-btn" class="carousel-btn">
                    <svg viewBox="0 0 24 24"><path fill="currentColor" d="M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z" /></svg>
                </button>
                <div class="carousel-viewport" id="carousel-viewport">
                    <div class="carousel-track" id="carousel-track">
                        <!-- Review cards will be populated by JS -->
                    </div>
                </div>
                <button id="next-btn" class="carousel-btn">
                    <svg viewBox="0 0 24 24"><path fill="currentColor" d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
                </button>
            </div>
        </div>
    </main>
    
    <!-- Review Details Modal -->
    <div class="modal" id="review-modal">
        <div class="modal-content" id="modal-content">
            <button class="modal-close" id="modal-close-btn">
                <svg width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
            </button>
            <div class="modal-body" id="modal-body">
                 <!-- Modal content populated by JS -->
            </div>
        </div>
    </div>

    <!-- Accept Success Modal -->
    <div class="modal" id="accept-modal">
        <div class="modal-content small">
            <button class="modal-close" id="accept-modal-close-btn">
                <svg width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
            </button>
            <div class="modal-body">
                <div class="success-icon">
                    <svg viewBox="0 0 24 24"><path fill="currentColor" d="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z" /></svg>
                </div>
                <h2 class="success-title">Review Accepted!</h2>
                <p class="success-message">The review has been successfully saved to the product.</p>
            </div>
        </div>
    </div>

    <!-- Reject Reason Modal -->
    <div class="modal" id="reject-modal">
        <div class="modal-content small">
            <button class="modal-close" id="reject-modal-close-btn">
                <svg width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
            </button>
            <div class="modal-body">
                <h2 class="reject-title">Reject Review</h2>
                <form class="reject-form" id="reject-form">
                    <div class="form-group">
                        <label class="form-label" for="reject-reason">Reason for rejection:</label>
                        <textarea 
                            class="form-textarea" 
                            id="reject-reason" 
                            name="reject-reason" 
                            placeholder="Please provide a reason for rejecting this review..."
                            required
                        ></textarea>
                    </div>
                    <button type="submit" class="form-submit">Submit Rejection</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Reject Success Modal -->
    <div class="modal" id="reject-success-modal">
        <div class="modal-content small">
            <button class="modal-close" id="reject-success-modal-close-btn">
                <svg width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
            </button>
            <div class="modal-body">
                <div class="success-icon">
                    <svg viewBox="0 0 24 24"><path fill="currentColor" d="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z" /></svg>
                </div>
                <h2 class="success-title">Rejection Captured</h2>
                <p class="success-message">Your rejection has been captured and saved.</p>
            </div>
        </div>
    </div>

    <!-- Edit Review Modal -->
    <div class="modal" id="edit-modal">
        <div class="modal-content">
            <button class="modal-close" id="edit-modal-close-btn">
                <svg width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
            </button>
            <div class="modal-body">
                <h2 class="edit-title">Edit Review</h2>
                
                <div class="current-review-preview" id="current-review-preview">
                    <div class="preview-title">Current Review:</div>
                    <div id="current-review-content" class="review-content"></div>
                    <div class="editing-animation" id="editing-animation">
                        <div class="typing-dots">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                        <div class="editing-text">Generating your edited review...</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                    </div>
                </div>

                <form class="edit-form" id="edit-form">
                    <div class="form-group">
                        <label class="form-label">Target Word Count:</label>
                        <div class="word-count-options">
                            <button type="button" class="word-count-btn" data-count="50">50 words</button>
                            <button type="button" class="word-count-btn" data-count="75">75 words</button>
                            <button type="button" class="word-count-btn active" data-count="100">100 words</button>
                            <button type="button" class="word-count-btn" data-count="150">150 words</button>
                            <button type="button" class="word-count-btn" data-count="200">200 words</button>
                        </div>
                        <input type="hidden" id="selected-word-count" name="word-count" value="100">
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="tone-adjustment">Tone Adjustment:</label>
                        <input 
                            type="text" 
                            class="form-input" 
                            id="tone-adjustment" 
                            name="tone-adjustment" 
                            placeholder="e.g., make this more formal, casual, scientific, warm, professional..."
                        />
                    </div>

                    <div class="form-row">
                        <button type="button" class="form-submit" id="cancel-edit-btn">Cancel</button>
                        <button type="submit" class="form-submit primary" id="generate-edit-btn">
                            <span id="generate-btn-text">Generate Edited Review</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Success Modal -->
    <div class="modal" id="edit-success-modal">
        <div class="modal-content">
            <button class="modal-close" id="edit-success-modal-close-btn">
                <svg width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
            </button>
            <div class="modal-body">
                <div class="success-icon">
                    <svg viewBox="0 0 24 24"><path fill="currentColor" d="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z" /></svg>
                </div>
                <h2 class="success-title">Review Updated!</h2>
                <div id="updated-review-content" class="current-review-preview">
                    <!-- Updated review content will be shown here -->
                </div>
                <div style="display: flex; gap: var(--spacing-md); justify-content: center; margin-top: var(--spacing-lg);">
                    <button class="form-submit" id="keep-original-btn">Keep Original</button>
                    <button class="form-submit primary" id="use-updated-btn">Use Updated Version</button>
                </div>
            </div>
        </div>
    </div>
    
    <footer class="footer">
        <div class="container"><p>&copy; 2024 FrontrowMD. All rights reserved.</p></div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const reviewsData = [
                {
                    doctorName: 'Dr. Evelyn Reed',
                    doctorImg: 'https://images.pexels.com/photos/5215024/pexels-photo-5215024.jpeg?auto=compress&cs=tinysrgb&w=400',
                    reviewTitle: 'A Breakthrough in Photoprotection',
                    reviewText: `<p>As a dermatologist, I consistently emphasize the importance of daily sun protection. However, the stability and efficacy of topical antioxidants can be a significant concern. This serum addresses that issue head-on.</p><p>I often recommend this to patients looking to boost their defense against environmental aggressors. The formulation, which combines 15% L-Ascorbic Acid with 1% Vitamin E and 0.5% Ferulic Acid, is supported by strong clinical evidence showing it not only stabilizes the vitamins but also doubles the photoprotection of the skin. It's an excellent addition to any morning skincare routine after cleansing and before moisturizing and sunscreen.</p>`,
                    research: [
                        { title: 'Ferulic acid stabilizes a solution of vitamins C and E and doubles its photoprotection of skin.', source: 'Journal of Investigative Dermatology', url: '#', excerpt: "This study demonstrates that a solution of 15% L-ascorbic acid, 1% alpha-tocopherol, and 0.5% ferulic acid provides a significant eight-fold increase in photoprotection against solar-simulated radiation." }
                    ],
                    prompt: `Generate a review from a dermatologist focusing on the product's photoprotective qualities. Emphasize the stability of the Vitamin C formula due to Ferulic Acid. Mention the key study: "Ferulic acid stabilizes a solution...". Tone: Clinical, reassuring, and educational.`
                },
                {
                    doctorName: 'Dr. Marcus Chen',
                    doctorImg: 'https://images.pexels.com/photos/5407206/pexels-photo-5407206.jpeg?auto=compress&cs=tinysrgb&w=400',
                    reviewTitle: 'Hydration is Key to Healthy Skin',
                    reviewText: `<p>Many of my patients struggle with dehydrated skin, which can exacerbate fine lines and lead to a dull complexion. This product is one of my top recommendations for restoring that crucial moisture barrier.</p><p>The inclusion of Hyaluronic Acid is what makes it so effective. This molecule is a powerhouse of hydration, capable of holding many times its weight in water. By incorporating this serum into your daily regimen, you are actively helping your skin retain the moisture it needs to look plump, healthy, and resilient. It's suitable for most skin types and layers well with other products.</p>`,
                    research: [
                        { title: 'The Role of Hyaluronic Acid in Skin Health and Rejuvenation', source: 'Dermato-Endocrinology', url: '#', excerpt: "Hyaluronic acid's unique capacity to retain water makes it a key component in maintaining skin hydration, elasticity, and volume." }
                    ],
                    prompt: `Generate a review from a primary care physician focusing on hydration. Explain the role of Hyaluronic Acid in simple terms for a patient. Tone: Warm, approachable, and focused on patient outcomes (plump, healthy skin).`
                },
                {
                    doctorName: 'Dr. Anya Sharma',
                    doctorImg: 'https://images.pexels.com/photos/5327921/pexels-photo-5327921.jpeg?auto=compress&cs=tinysrgb&w=400',
                    reviewTitle: 'Optimizing Vitamin C Delivery',
                    reviewText: `<p>Patients often ask if expensive Vitamin C serums are worth it. My answer always depends on the formulation. For Vitamin C to be effective, it needs to be able to penetrate the skin, and that's where this product excels.</p><p>Clinical studies on percutaneous absorption have shown that an acidic pH is critical for topical L-Ascorbic Acid to be effective. This serum is formulated at an optimal pH, which means you're not just applying a nice ingredient, you're applying one that can actually get to where it needs to go to provide antioxidant benefits. I appreciate the science-first approach to its design.</p>`,
                    research: [
                        { title: 'Topical L-Ascorbic Acid: Percutaneous Absorption Studies', source: 'Dermatologic Surgery', url: '#', excerpt: "Maximum absorption was achieved with a 20% vitamin C concentration... an acidic pH (below 3.5) is required for optimal percutaneous absorption." }
                    ],
                    prompt: `Generate a review from a scientific, detail-oriented doctor. Focus on the importance of formulation and pH for Vitamin C absorption, referencing the "Percutaneous Absorption Studies". Tone: Technical but clear, precise, and authoritative.`
                },
                {
                    doctorName: 'Dr. Ben Carter',
                    doctorImg: 'https://images.pexels.com/photos/8442533/pexels-photo-8442533.jpeg?auto=compress&cs=tinysrgb&w=400',
                    reviewTitle: 'A Gentle Giant for Skin Health',
                    reviewText: `<p>In my practice, I see many patients with sensitive skin who are wary of trying active ingredients. This serum is a product I feel confident recommending for them to try.</p><p>While it is a potent antioxidant cocktail, the formulation is elegant and generally well-tolerated. The combination of ingredients works synergistically not just to protect the skin, but also to calm and support it. Patients report that over time their skin feels less reactive and looks healthier. It's a fantastic, gentle entry point into using targeted serums for long-term skin health.</p>`,
                    research: [],
                    prompt: `Generate a review from a family doctor for patients with sensitive skin. The focus should be on the product being "well-tolerated" and "gentle" despite being potent. Tone: Caring, gentle, and reassuring.`
                },
                {
                    doctorName: 'Dr. Olivia Martinez',
                    doctorImg: 'https://images.pexels.com/photos/5794711/pexels-photo-5794711.jpeg?auto=compress&cs=tinysrgb&w=400',
                    reviewTitle: 'The Foundation of a Solid Routine',
                    reviewText: `<p>When building a skincare routine, there are a few foundational pillars I recommend: cleansing, moisturizing, and sun protection. For those looking to elevate their routine, an antioxidant serum like this is the next logical step.</p><p>It provides a crucial layer of defense that sunscreen alone cannot. By neutralizing free radicals from UV and environmental exposure, it helps prevent the breakdown of collagen and supports the skin's natural repair processes. Think of it as an insurance policy for your skin's future health and appearance. This is a solid, evidence-based choice.</p>`,
                    research: [
                        { title: 'Ferulic acid stabilizes a solution of vitamins C and E...', source: 'Journal of Investigative Dermatology', url: '#', excerpt: "This study demonstrates that a solution of 15% L-ascorbic acid, 1% alpha-tocopherol, and 0.5% ferulic acid provides a significant eight-fold increase in photoprotection against solar-simulated radiation." },
                        { title: 'The Role of Hyaluronic Acid in Skin Health...', source: 'Dermato-Endocrinology', url: '#', excerpt: "Hyaluronic acid's unique capacity to retain water makes it a key component in maintaining skin hydration, elasticity, and volume." }
                    ],
                    prompt: `Generate a review from a holistic health practitioner. Frame the product as a "foundational" part of a complete skincare routine, complementing sunscreen. Explain the concept of neutralizing free radicals in a simple, analogy-driven way. Tone: Holistic, preventative, and encouraging.`
                }
            ];

            const viewport = document.getElementById('carousel-viewport');
            const track = document.getElementById('carousel-track');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            // Existing modal elements
            const modal = document.getElementById('review-modal');
            const modalBody = document.getElementById('modal-body');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            
            // Action modal elements
            const acceptModal = document.getElementById('accept-modal');
            const acceptModalCloseBtn = document.getElementById('accept-modal-close-btn');
            const rejectModal = document.getElementById('reject-modal');
            const rejectModalCloseBtn = document.getElementById('reject-modal-close-btn');
            const rejectSuccessModal = document.getElementById('reject-success-modal');
            const rejectSuccessModalCloseBtn = document.getElementById('reject-success-modal-close-btn');
            const rejectForm = document.getElementById('reject-form');

            // Edit modal elements
            const editModal = document.getElementById('edit-modal');
            const editModalCloseBtn = document.getElementById('edit-modal-close-btn');
            const editSuccessModal = document.getElementById('edit-success-modal');
            const editSuccessModalCloseBtn = document.getElementById('edit-success-modal-close-btn');
            const editForm = document.getElementById('edit-form');
            const currentReviewContent = document.getElementById('current-review-content');
            const updatedReviewContent = document.getElementById('updated-review-content');
            const generateBtnText = document.getElementById('generate-btn-text');
            const generateEditBtn = document.getElementById('generate-edit-btn');
            const cancelEditBtn = document.getElementById('cancel-edit-btn');
            const keepOriginalBtn = document.getElementById('keep-original-btn');
            const useUpdatedBtn = document.getElementById('use-updated-btn');

            let currentIndex = 0;
            let cards = [];
            let currentEditingIndex = -1;
            let updatedReviewData = null;
            
            function renderCarousel() {
                track.innerHTML = '';
                reviewsData.forEach((review, index) => {
                    const card = document.createElement('div');
                    card.className = 'review-card';
                    card.dataset.index = index;
                    
                    const shortText = review.reviewText.split('</p>')[0].replace('<p>', '') + '...';

                    card.innerHTML = `
                        <div class="card-actions">
                            <button class="edit-icon" onclick="editReview(${index}); event.stopPropagation();">
                                <svg viewBox="0 0 24 24"><path fill="currentColor" d="M3,17.25V21H6.75L17.81,9.94L14.06,6.19L3,17.25M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.13,5.12L18.88,8.87M5.92,19.08L5.92,19.08L18.88,6.12" /></svg>
                            </button>
                            <button class="action-btn accept" onclick="acceptReview(${index}); event.stopPropagation();">Accept</button>
                            <button class="action-btn reject" onclick="rejectReview(${index}); event.stopPropagation();">Reject</button>
                        </div>
                        <div class="doctor-info">
                            <img src="${review.doctorImg}" alt="${review.doctorName}">
                            <span class="name">${review.doctorName}</span>
                        </div>
                        <h2 class="review-card__title">${review.reviewTitle}</h2>
                        <p class="review-card__text">${shortText}</p>
                    `;
                    card.addEventListener('click', () => openModal(index));
                    track.appendChild(card);
                });
                cards = document.querySelectorAll('.review-card');
                updateCarousel();
            }

            function updateCarousel() {
                const cardWidth = cards[0].offsetWidth;
                const gap = 20;
                const offset = -currentIndex * (cardWidth + gap) + (viewport.offsetWidth / 2 - cardWidth / 2);
                
                track.style.transform = `translateX(${offset}px)`;

                cards.forEach((card, index) => {
                    card.classList.toggle('is-active', index === currentIndex);
                });
            }

            function showNext() {
                currentIndex = (currentIndex + 1) % cards.length;
                updateCarousel();
            }

            function showPrev() {
                currentIndex = (currentIndex - 1 + cards.length) % cards.length;
                updateCarousel();
            }

            function openModal(index) {
                const review = reviewsData[index];
                
                let researchHTML = '';
                if (review.research.length > 0) {
                    review.research.forEach(item => {
                        researchHTML += `
                        <li>
                            <div class="modal-research-card">
                                <h4 class="modal-research-card__title">${item.title}</h4>
                                <p class="modal-research-card__source">Source: <a href="${item.url}" target="_blank">${item.source}</a></p>
                                <p class="modal-research-card__excerpt">${item.excerpt}</p>
                            </div>
                        </li>`;
                    });
                } else {
                    researchHTML = '<li>No specific studies cited for this review.</li>';
                }

                modalBody.innerHTML = `
                    <div class="doctor-info" id="modal-doctor-info">
                        <img src="${review.doctorImg}" alt="${review.doctorName}">
                        <span id="modal-doctor-name" class="name">${review.doctorName}</span>
                    </div>
                    <h2 id="modal-review-title" class="review-card__title">${review.reviewTitle}</h2>
                    <div id="modal-review-text">${review.reviewText}</div>
                    
                    <h3 class="modal-section-title">Supporting Research</h3>
                    <ul id="modal-research-list">${researchHTML}</ul>
                    
                    <h3 class="modal-section-title">Generation Prompt</h3>
                    <pre id="modal-prompt" class="prompt-display">${review.prompt}</pre>
                `;
                
                modal.classList.add('is-visible');
            }

            function closeModal() {
                modal.classList.remove('is-visible');
            }

            function closeAcceptModal() {
                acceptModal.classList.remove('is-visible');
            }

            function closeRejectModal() {
                rejectModal.classList.remove('is-visible');
            }

            function closeRejectSuccessModal() {
                rejectSuccessModal.classList.remove('is-visible');
            }

            function closeEditModal() {
                editModal.classList.remove('is-visible');
                currentEditingIndex = -1;
                editForm.reset();
                document.getElementById('selected-word-count').value = '100';
                document.querySelectorAll('.word-count-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelector('.word-count-btn[data-count="100"]').classList.add('active');
            }

            function closeEditSuccessModal() {
                editSuccessModal.classList.remove('is-visible');
                updatedReviewData = null;
            }

            // Word count helper function
            function countWords(text) {
                return text.replace(/<[^>]*>/g, '').trim().split(/\s+/).length;
            }

            // Global functions for onclick handlers
            window.openModal = openModal;
            
            window.acceptReview = function(index) {
                const review = reviewsData[index];
                console.log('Accepting review:', review.reviewTitle);
                acceptModal.classList.add('is-visible');
            };

            window.rejectReview = function(index) {
                const review = reviewsData[index];
                console.log('Rejecting review:', review.reviewTitle);
                rejectModal.classList.add('is-visible');
            };

            window.editReview = function(index) {
                const review = reviewsData[index];
                currentEditingIndex = index;
                
                // Show current review content
                const currentWordCount = countWords(review.reviewText);
                currentReviewContent.innerHTML = `
                    <strong>${review.reviewTitle}</strong> (${currentWordCount} words)<br><br>
                    ${review.reviewText}
                `;
                
                editModal.classList.add('is-visible');
            };

            // Word count button functionality
            document.querySelectorAll('.word-count-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.word-count-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    document.getElementById('selected-word-count').value = btn.dataset.count;
                });
            });

            // Event listeners
            prevBtn.addEventListener('click', showPrev);
            nextBtn.addEventListener('click', showNext);
            
            // Existing modal close handlers
            modalCloseBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal();
            });

            // Accept modal close handlers
            acceptModalCloseBtn.addEventListener('click', closeAcceptModal);
            acceptModal.addEventListener('click', (e) => {
                if (e.target === acceptModal) closeAcceptModal();
            });

            // Reject modal close handlers
            rejectModalCloseBtn.addEventListener('click', closeRejectModal);
            rejectModal.addEventListener('click', (e) => {
                if (e.target === rejectModal) closeRejectModal();
            });

            // Reject success modal close handlers
            rejectSuccessModalCloseBtn.addEventListener('click', closeRejectSuccessModal);
            rejectSuccessModal.addEventListener('click', (e) => {
                if (e.target === rejectSuccessModal) closeRejectSuccessModal();
            });

            // Edit modal close handlers
            editModalCloseBtn.addEventListener('click', closeEditModal);
            editModal.addEventListener('click', (e) => {
                if (e.target === editModal) closeEditModal();
            });
            cancelEditBtn.addEventListener('click', closeEditModal);

            // Edit success modal close handlers
            editSuccessModalCloseBtn.addEventListener('click', closeEditSuccessModal);
            editSuccessModal.addEventListener('click', (e) => {
                if (e.target === editSuccessModal) closeEditSuccessModal();
            });

            // Reject form submission
            rejectForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const reason = document.getElementById('reject-reason').value.trim();
                
                if (reason) {
                    console.log('Rejection reason:', reason);
                    closeRejectModal();
                    rejectSuccessModal.classList.add('is-visible');
                    rejectForm.reset();
                }
            });

            // Edit form submission
            editForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const wordCount = document.getElementById('selected-word-count').value;
                const toneAdjustment = document.getElementById('tone-adjustment').value.trim();
                
                if (!toneAdjustment) {
                    alert('Please provide a tone adjustment instruction.');
                    return;
                }

                // Show animation
                const currentReviewPreview = document.getElementById('current-review-preview');
                const reviewContent = document.getElementById('current-review-content');
                const editingAnimation = document.getElementById('editing-animation');
                const progressFill = document.getElementById('progress-fill');
                
                // Start animation
                currentReviewPreview.classList.add('editing');
                reviewContent.classList.add('fade-out');
                editingAnimation.classList.add('active');
                
                // Disable button
                generateEditBtn.disabled = true;
                generateBtnText.textContent = 'Generating...';
                
                // Animate progress bar over 2 seconds
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += 2;
                    progressFill.style.width = progress + '%';
                    if (progress >= 100) {
                        clearInterval(progressInterval);
                    }
                }, 40); // 40ms * 50 = 2000ms (2 seconds)

                try {
                    // Simulate API call (replace with actual API call)
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // Mock updated review (replace with actual API response)
                    const originalReview = reviewsData[currentEditingIndex];
                    updatedReviewData = {
                        ...originalReview,
                        reviewText: `<p>This is a mock updated review with approximately ${wordCount} words. The tone has been adjusted based on: "${toneAdjustment}". ${originalReview.reviewText.substring(50)}</p>`,
                        reviewTitle: originalReview.reviewTitle + ' (Edited)'
                    };
                    
                    const newWordCount = countWords(updatedReviewData.reviewText);
                    updatedReviewContent.innerHTML = `
                        <div class="preview-title">Updated Review (${newWordCount} words):</div>
                        <strong>${updatedReviewData.reviewTitle}</strong><br><br>
                        ${updatedReviewData.reviewText}
                    `;
                    
                    // Reset animation state
                    currentReviewPreview.classList.remove('editing');
                    reviewContent.classList.remove('fade-out');
                    editingAnimation.classList.remove('active');
                    progressFill.style.width = '0%';
                    
                    closeEditModal();
                    editSuccessModal.classList.add('is-visible');
                    
                } catch (error) {
                    alert('Error generating edited review. Please try again.');
                    console.error('Edit error:', error);
                    
                    // Reset animation state on error
                    currentReviewPreview.classList.remove('editing');
                    reviewContent.classList.remove('fade-out');
                    editingAnimation.classList.remove('active');
                    progressFill.style.width = '0%';
                } finally {
                    // Reset button state
                    generateEditBtn.disabled = false;
                    generateBtnText.textContent = 'Generate Edited Review';
                }
            });

            // Keep original button
            keepOriginalBtn.addEventListener('click', () => {
                closeEditSuccessModal();
            });

            // Use updated version button
            useUpdatedBtn.addEventListener('click', () => {
                if (updatedReviewData && currentEditingIndex >= 0) {
                    // Update the review data
                    reviewsData[currentEditingIndex] = updatedReviewData;
                    
                    // Re-render the carousel to show updated content
                    renderCarousel();
                    
                    // Update current index to the edited card
                    currentIndex = currentEditingIndex;
                    updateCarousel();
                    
                    closeEditSuccessModal();
                }
            });

            renderCarousel();
            window.addEventListener('resize', updateCarousel);
        });
    </script>
</body>
</html>